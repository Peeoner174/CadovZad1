---
description: 'Описание логики, которая реализована на IOS'
---

# Логика выборных свойств\(IOS\)

Товар с выборными свойствами представляет собой группу товаров, которая описывает все доступные вариации выборных свойств данного товара. Каждый товар группы имеет свой уникальный id.

Товары в данной группе делятся на две категории:

1\) **Основной товар:** в группе может существовать только в единичном экземпляре; Служит для отображения общей информации о группе товаров; Значение выборного свойства у основного товара служит плейсхолдером, данное значение отображается серым цветом,  в списке доступных вариантов выбора свойства не отображается; Основной товар невозможно поместить в корзину

2\) **Смежный товар:** Изначально знает только о своем основном товаре, поэтому после получения всех товаров группы с сервера, необходимо дополнительно строить связи между ними\(см. ниже, в шаге 2\); Каждый смежный товар отображает одну вариативность данного товара, доступную для заказа; Смежный товар не отображается в каталоге, но отображается в "Недавно просмотренных", а также в категории "Избранное"

#### Этап формирования экрана товара с выборными свойствами

#### ШАГ 1

#### Запросы при заходе на экран с подробным описанием товара\(ESItemDetailsView\):

#### Запрос основного товара группы

```
CatalogsAPI /static/catalog/items/{itemId}/
```

#### Запрос массива смежных товаров

```
CatalogsAPI /static/catalog/items/{itemId}/contiguous/"

Данный запрос вернет массив всех зависимых товаров в случае, 
если itemId относится к основному товару(его contiguous == false), 
и только родительский товар, если itemId принадлежит смежному товару  
```

Данные запросы выполняются асинхронно 

#### ШАГ 2

Если запросы завершились успешно и товар имеет зависимые товары\(contiguous items\), тогда формируются связи между ними. Создается массив элементов \[ESItem\] который сохраняется или перезаписывается в БД, во все товары группы записывается массив id всех остальных товаров его группы\(поле contiguousItemsIds\), каждый товар группы помечается соответствующей меткой, обозначающей, является ли он основным или смежным \(поле isContiguous\). 

#### ЛОГИКА ПЕРЕКЛЮЧЕНИЯ МЕЖДУ ВЫБОРНЫМИ СВОЙСТВАМИ

Логика выборных свойств осуществляется с помощью структуры `SelectableAttributeDataField`

`itemIds - id всех товаров, у которых данные свойство имеет данное значение`

Одному варианту выборного свойства может соответствовать несколько товаров в группе в том случае, если у товара есть несколько выборных свойств.

`fieldValue - строковое значение, которое отображается в варианте выбора`

`isRadioSelected - данный вариант выборного свойства выбран`

`updatedAt - по этому полю формируется порядок выборных свойств в списке(точно также сделано в админке)`

#### ESItemDetailsView -&gt; `getItemIdOnUpdate()` 

После изменения какого либо из выборных свойств у товара, вызывается функция `getItemIdOnUpdate().` 

У каждого выбранного свойства достается массив`itemIds,`**`если есть id который повторяется для всех выборных свойств, карточка товара релодиться и отображаемый товар меняется на соответствующий`**`.` 

**\`\`**



